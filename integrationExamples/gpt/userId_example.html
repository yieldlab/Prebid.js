<!DOCTYPE html>
<html lang="en">

<head>
  <title>User ID Modules Example</title>

  <script>
    var FAILSAFE_TIMEOUT = 2000;

    var adUnits = [
      {
        code: 'test-div',
        mediaTypes: {
          banner: {
            sizes: [[300, 250], [300, 600], [728, 90]]
          }
        },
        bids: [
          {
            bidder: 'yieldlab',
            params: {
              supplyId: '1381604',
              adslotId: '113932',
            }
          }
        ]
      }
    ];

    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];
  </script>
  <script src="../../build/dev/prebid.js" async></script>

  <script>
    function getHashedEmail() { }
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    googletag.cmd.push(function () {
      googletag.pubads().disableInitialLoad();
    });

    pbjs.que.push(function () {
      pbjs.setConfig({
        "debug": true,
        // *************************************************************************
        // ** COMMENT consentManagement BLOCK IF YOU DO NOT WANT TO SIMULATE GDPR **
        // *************************************************************************
        // "consentManagement": {
        //   "cmpApi": "static",
        //   "consentData": {
        //     "getTCData": {
        //       "tcString": "CO-HDlqO-HDlqAKAXCENBDCsAP_AAH_AACiQHKNd_X_fb39j-_59_9t0eY1f9_7_v20zjgeds-8Nyd_X_L8X42M7vF36pq4KuR4Eu3LBIQFlHOHcTUmw6IkVqTPsak2Mr7NKJ7PEinMbe2dYGHtfn9VTuZKYr97s___z__-__v__75f_r-3_3_vp9V---_fA5QAkw1L4CLMSxwJJo0qhRAhCuJDoAQAUUIwtE1hASuCnZXAR-ggYAIDUBGBECDEFGLIIAAAAAkoiAkAPBAIgCIBAACAFSAhAARoAgsAJAwCAAUA0LACKAIQJCDI4KjlMCAiRaKCeSMASi72MMIQyigBoFH4AAAAA.cAAAAAAAAAAA",
        //       "cmpId": 10,
        //       "cmpVersion": 23,
        //       "tcfPolicyVersion": 2,
        //       "gdprApplies": true,
        //       "cmpStatus": "loaded",
        //       "eventStatus": "tcloaded",
        //       "purpose": {
        //         "consents": {
        //           "1": true,
        //           "2": true
        //         }
        //       },
        //       "vendor": {
        //         "consents": {
        //           // add your GVL ID here and set to true to give consent within pbjs
        //           "52": true,     // rubicon for adserving
        //           "21": true,     // unifiedId
        //           "131": true,    // id5Id
        //           "929": true,    // parrableId
        //           "97": true,     // identityLink
        //           "887": true,    // uid2
        //           "95": true,     // lotamePanoramaId
        //           "301": true,    // zeotapIdPlus
        //           "91": true,     // criteo
        //           "737": true,    // amxId
        //           "58": true,     // 33acrossId
        //         }
        //       }
        //     }
        //   }
        // },
        "userSync": {
          "userIds": [
            {
                name: "yieldlab",
                value: { "ylid": ["1234", "5678", "91011"] }
            },

            {
                name: "netId",
                value: { "netId": "xxxfH5A3n2O8_CZZyPoJVD-eabc6ECb7jhxCicsds7qSg" }
            },
            {
                name: "criteo",
                value: { "criteoId": "wK-fkF8zaEIlMkZMbHl3eFo4NEtoNmZaeXJtYkFjZlVuWjBhcjJMaTRYd3pZNSUyQnlKRHNGRXlpdzdjd3pjVzhjcSUyQmY4eTFzN3VSZjV1ZyUyRlA0U2ZiR0UwN2I4bDZRJTNEJTNE" }
            }
          ],"syncDelay": 5000,
          "auctionDelay": 1000
        }
      });
      pbjs.addAdUnits(adUnits);
      pbjs.requestBids({
        bidsBackHandler: sendAdserverRequest
      });
    });

    function sendAdserverRequest() {
      if (pbjs.adserverRequestSent) return;
      pbjs.adserverRequestSent = true;
      googletag.cmd.push(function () {
        pbjs.que.push(function () {
          pbjs.setTargetingForGPTAsync();
          googletag.pubads().refresh();
        });
      });
    }

    setTimeout(function () {
      sendAdserverRequest();
    }, FAILSAFE_TIMEOUT);
  </script>

  <script>
    (function () {
      var gads = document.createElement('script');
      gads.async = true;
      gads.type = 'text/javascript';
      gads.src = 'https://securepubads.g.doubleclick.net/tag/js/gpt.js';
      var node = document.getElementsByTagName('script')[0];
      node.parentNode.insertBefore(gads, node);
    })();
  </script>

  <script>
    googletag.cmd.push(function () {
      googletag.defineSlot('/112115922/FL_PB_MedRect', [[300, 250], [300, 600], [728, 90]], 'test-div').addService(googletag.pubads());
      googletag.pubads().enableSingleRequest();
      googletag.enableServices();
    });
  </script>
</head>

<body>
  <h2>User ID Modules Example</h2>

  <h4>Generated EIDs</h4>
  <script>
    pbjs.que.push(function () {
      var idsDiv = document.getElementById('ids-div');
      idsDiv.innerHTML = JSON.stringify(pbjs.getUserIdsAsEids(), null, ' ');
    });
  </script>
  <pre id="ids-div" style="border:1px solid #333; padding:5px; overflow: scroll"></pre>

  <h4>Ad Slot</h4>
  <div id="test-div" style="border:1px solid #333; padding:5px;">
    <script>
      googletag.cmd.push(function () { googletag.display('test-div'); });
    </script>
  </div>
</body>

</html>
